{"version":3,"file":"plugin.js","sources":["../../../src/utils/plugin.ts"],"sourcesContent":["import 'systemjs/dist/system';\n// Add ability to load plugins bundled as AMD format\nimport 'systemjs/dist/extras/amd';\n// Add ability to load plugins bundled as CJS format\nimport 'systemjs-cjs-extra';\n\nimport { PanelPlugin } from '@grafana/data';\n\nimport { config } from '../config';\n\n/**\n * Option to specify a plugin css that should be applied for the dark\n * and the light theme.\n *\n * @public\n */\nexport interface PluginCssOptions {\n  light: string;\n  dark: string;\n}\n\n/**\n * @internal\n */\nexport const SystemJS = window.System;\n\n/**\n * Use this to load css for a Grafana plugin by specifying a {@link PluginCssOptions}\n * containing styling for the dark and the light theme.\n *\n * @param options - plugin styling for light and dark theme.\n * @public\n */\nexport async function loadPluginCss(options: PluginCssOptions): Promise<System.Module | void> {\n  try {\n    const cssPath = config.bootData.user.theme === 'light' ? options.light : options.dark;\n    return SystemJS.import(cssPath);\n  } catch (err) {\n    console.error(err);\n  }\n}\n\ninterface PluginImportUtils {\n  importPanelPlugin: (id: string) => Promise<PanelPlugin>;\n  getPanelPluginFromCache: (id: string) => PanelPlugin | undefined;\n}\n\nlet pluginImportUtils: PluginImportUtils | undefined;\n\nexport function setPluginImportUtils(utils: PluginImportUtils) {\n  if (pluginImportUtils) {\n    throw new Error('pluginImportUtils should only be set once, when Grafana is starting.');\n  }\n\n  pluginImportUtils = utils;\n}\n\nexport function getPluginImportUtils(): PluginImportUtils {\n  if (!pluginImportUtils) {\n    throw new Error('pluginImportUtils can only be used after Grafana instance has started.');\n  }\n\n  return pluginImportUtils;\n}\n\n// Grafana relies on RequireJS for Monaco Editor to load.\n// The SystemJS AMD extra creates a global define which causes RequireJS to silently bail.\n// Here we move and reset global define so Monaco Editor loader script continues to work.\n// @ts-ignore\nwindow.__grafana_amd_define = window.define;\n// @ts-ignore\nwindow.define = undefined;\n"],"names":[],"mappings":";;;;;AAwBO,MAAM,WAAW,MAAO,CAAA,OAAA;AAS/B,eAAsB,cAAc,OAA0D,EAAA;AAC5F,EAAI,IAAA;AACF,IAAM,MAAA,OAAA,GAAU,OAAO,QAAS,CAAA,IAAA,CAAK,UAAU,OAAU,GAAA,OAAA,CAAQ,QAAQ,OAAQ,CAAA,IAAA,CAAA;AACjF,IAAO,OAAA,QAAA,CAAS,OAAO,OAAO,CAAA,CAAA;AAAA,WACvB,GAAK,EAAA;AACZ,IAAA,OAAA,CAAQ,MAAM,GAAG,CAAA,CAAA;AAAA,GACnB;AACF,CAAA;AAOA,IAAI,iBAAA,CAAA;AAEG,SAAS,qBAAqB,KAA0B,EAAA;AAC7D,EAAA,IAAI,iBAAmB,EAAA;AACrB,IAAM,MAAA,IAAI,MAAM,sEAAsE,CAAA,CAAA;AAAA,GACxF;AAEA,EAAoB,iBAAA,GAAA,KAAA,CAAA;AACtB,CAAA;AAEO,SAAS,oBAA0C,GAAA;AACxD,EAAA,IAAI,CAAC,iBAAmB,EAAA;AACtB,IAAM,MAAA,IAAI,MAAM,wEAAwE,CAAA,CAAA;AAAA,GAC1F;AAEA,EAAO,OAAA,iBAAA,CAAA;AACT,CAAA;AAMA,MAAA,CAAO,uBAAuB,MAAO,CAAA,MAAA,CAAA;AAErC,MAAA,CAAO,MAAS,GAAA,KAAA,CAAA;;;;"}